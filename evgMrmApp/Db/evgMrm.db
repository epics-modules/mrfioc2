record(mbbo, "$(P)Enable-Sel") {
  field(DESC, "EVG Master Enable")
  field(DTYP, "Obj Prop uint16")
  field(OUT , "@OBJ=$(OBJ), PROP=Enable")
  field(ZRST, "Disabled")
  field(ONST, "Enabled")
  field(TWST, "Ena Master")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(PINI, "RUNNING")
  field(VAL,  "1")
  field(FLNK, "$(P)Enable-RB")
  info(autosaveFields_pass0, "VAL")
}

record(mbbi, "$(P)Enable-RB") {
  field(DESC, "EVG Master Enable")
  field(DTYP, "Obj Prop uint16")
  field(INP , "@OBJ=$(OBJ), PROP=Enable")
  field(ZRST, "Disabled")
  field(ONST, "Enabled")
  field(TWST, "Ena Master")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
}

record(stringin, "$(P)FwVer-I") {
  field(DTYP, "Obj Prop string")
  field(INP , "@OBJ=$(OBJ), PROP=Version")
  field(PINI, "YES")
  field(DESC, "Firmware version")
}

record(stringin, "$(P)SwVer-I") {
  field(DTYP, "Obj Prop string")
  field(INP , "@OBJ=$(OBJ), PROP=Sw Version")
  field(PINI, "YES")
  field(DESC, "Software version")
}

record(stringin, "$(P)CommitHash-I") {
  field(DTYP, "Obj Prop string")
  field(INP , "@OBJ=$(OBJ), PROP=CommitHash")
  field(PINI, "YES")
  field(DESC, "Commit hash")
}

record(bo, "$(P)ResetMxc-Cmd") {
  field(DTYP, "Obj Prop bool")
  field(OUT , "@OBJ=$(OBJ), PROP=Reset MXC")
  field(DESC, "EVG Reset MXC")
  field(PINI, "YES")
  field(VAL, "1")
  field(UDF, "0")
}

record(longout, "$(P)SendEvt-SP") {
  field(DESC, "EVG Software Event Code")
  field(DTYP, "Obj Prop uint32")
  field(OUT,  "@OBJ=$(OBJ), PROP=EvtCode")
  field(UDF,  "0")
  field(PINI, "YES") # so users don't complain about INVALID/UDF.  Safe as long as VAL=0. aka never autosave!
  field(VAL,  "0")
  field(HIHI, "256")
  field(LOLO, "-1")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
    alias("$(SOFTEVT)EvtCode-SP")
}

record (stringin, "$(P)Timestamp-RB") {
  field(DTYP, "Obj Prop string")
  field(INP , "@OBJ=$(OBJ), PROP=NextSecond")
  field(SCAN, "I/O Intr")
  field(FLNK, "$(P)TimeErr-I")
}

record(bo, "$(P)SimTimestamp-Sel") {
  field(DTYP, "Obj Prop bool")
  field(OUT , "@OBJ=$(OBJ), PROP=SimTime")
  field(OMSL, "closed_loop")
  field(DOL , "$(P)PpsInp-MbbiDir_.BF CP")
  field(ZNAM, "Normal")
  field(ONAM, "Simulate")
}

record(bo, "$(P)SoftTickSecond-Cmd") {
  field(DTYP, "Obj Prop command")
  field(DESC, "Tick second via EPICS scan")
  field(OUT , "@OBJ=$(OBJ), PROP=SoftTick")
  field(DISV, 0)
  field(SDIS, "$(P)PpsInp1-MbbiDir_.BF")
  field(SCAN, "1 second")
}

record(ai, "$(P)TimeErr-I") {
  field(DTYP, "Obj Prop double")
  field(INP , "@OBJ=$(OBJ), PROP=Time Error")
}

record(bo,"$(P)SyncTimestamp-Cmd" ) {
  field(DTYP, "Obj Prop command")
  field(OUT , "@OBJ=$(OBJ), PROP=Sync TS")
  field(DESC, "EVG Sync TimeStamp")
}

record(mbbo, "$(P)PpsInp-Sel") {
  field(DESC, "EVG Pps Input")
  field(PINI, "YES")
  field(UDF,  "0")
  field(VAL,  "0")
  field(ZRST, "None")
  field(ONST, "Front0")
  field(TWST, "Front1")
  field(THST, "Univ0")
  field(FRST, "Univ1")
  field(FVST, "Univ2")
  field(SXST, "Univ3")
  field(SVST, "Sys Clk")
  field(EIST, "Front2")
  field(NIST, "Univ4")
  field(TEST, "Univ5")
  field(ELST, "Univ6")
  field(TVST, "Univ7")
  field(TTST, "Univ8")
  field(FTST, "Univ9")
  field(FFST, "Univ10")
  field(ZRVL, "0x0")
  field(ONVL, "0x1")
  field(TWVL, "0x2")
  field(THVL, "0x4")
  field(FRVL, "0x8")
  field(FVVL, "0x10")
  field(SXVL, "0x20")
  field(SVVL, "0x8000")
  field(EIVL, "0x40")
  field(NIVL, "0x80")
  field(TEVL, "0x100")
  field(ELVL, "0x200")
  field(TVVL, "0x400")
  field(TTVL, "0x800")
  field(FTVL, "0x1000")
  field(FFVL, "0x2000")
  field(UNSV, "INVALID")
  field(IVOA, "Don't drive outputs")
  field(FLNK, "$(P)PpsInp-CO_")
  info(autosaveFields_pass0, "VAL")
}
record(calcout, "$(P)PpsInp-CO_") {
  field(ASG, "private")
  field(INPA, "$(P)PpsInp-Sel NPP")
  field(CALC, "A")
  field(OOPT, "When Non-zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "0") # when PpsInp-Sel is not 0, set other PpsInp to 0
  field(OUT , "$(P)PpsInp-DFO_ PP")
}
record(dfanout, "$(P)PpsInp-DFO_"){
  field(SELM, "All")
  field(OUTA, "$(P)PpsInp1-Sel PP")
  #field(OUTB, "$(P)PpsInp2-Sel PP")
  field(FLNK, "$(P)PpsInp-MbbiDir_")
}
#
# Each bit of the PpsInp-MbbiDir record is used to toggle the external input
# interrupt of the corresponding external input.
#
record(mbbiDirect, "$(P)PpsInp-MbbiDir_") {
  field(ASG, "private")
  field(DESC, "EVG Pps Input")
  field(INP,  "$(P)PpsInp-Sel.RVAL NPP")
}
record(mbbo, "$(P)PpsInp1-Sel") {
  field(DESC, "EVG Pps Input")
  field(PINI, "YES")
  field(UDF,  "0")
  field(VAL,  "0")
  field(ZRST, "None")
  field(ONST, "UnivInp11")
  field(TWST, "UnivInp12")
  field(THST, "UnivInp13")
  field(FRST, "UnivInp14")
  field(FVST, "UnivInp15")
  field(SXST, "EPICS Scan")
  field(ZRVL, "0x0")
  field(ONVL, "0x1")
  field(TWVL, "0x2")
  field(THVL, "0x4")
  field(FRVL, "0x8")
  field(FVVL, "0x10")
  field(SXVL, "0x8000")
  field(SVSV, "INVALID")
  field(EISV, "INVALID")
  field(NISV, "INVALID")
  field(TESV, "INVALID")
  field(ELSV, "INVALID")
  field(TVSV, "INVALID")
  field(TTSV, "INVALID")
  field(FTSV, "INVALID")
  field(FFSV, "INVALID")
  field(UNSV, "INVALID")
  field(IVOA, "Don't drive outputs")
  field(FLNK, "$(P)PpsInp1-CO_")
  info(autosaveFields_pass0, "VAL")
}
record(calcout, "$(P)PpsInp1-CO_") {
  field(ASG, "private")
  field(INPA, "$(P)PpsInp1-Sel NPP")
  field(CALC, "A")
  field(OOPT, "When Non-zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "0") # when PpsInp-Sel is not 0, set other PpsInp to 0
  field(OUT , "$(P)PpsInp1-DFO_ PP")
}
record(dfanout, "$(P)PpsInp1-DFO_"){
  field(SELM, "All")
  field(OUTA, "$(P)PpsInp-Sel PP")
  #field(OUTB, "$(P)PpsInp2-Sel PP")
  field(FLNK, "$(P)PpsInp1-MbbiDir_")
}
#
# Each bit of the PpsInp-MbbiDir record is used to toggle the external input
# interrupt of the corresponding external input.
#
record(mbbiDirect, "$(P)PpsInp1-MbbiDir_") {
  field(ASG, "private")
  field(DESC, "EVG Pps Input")
  field(INP,  "$(P)PpsInp1-Sel.RVAL NPP")
}
record(longin, "$(P)DbusStatus-RB" ) {
  field(DESC, "EVG Dbus Status")
  field(DTYP, "Obj Prop uint32")
  field(INP , "@OBJ=$(OBJ), PROP=DbusStatus")
  info(autosaveFields_pass0, "SCAN")
}

#
# Timestamp Generator Select
#
record(mbbo, "$(P)TSGen-SP") {
  field(DESC, "EVG TS Generator")
  field(DTYP, "Obj Prop uint16")
  field(OUT,  "@OBJ=$(OBJ), PROP=TS Generator")
  field(PINI, "YES")
  field(UDF,  "0")
  field(VAL,  "0")
  field(ZRST, "Software")
  field(ONST, "Internal")
  field(TWST, "External")
  field(ZRVL, "0x0")
  field(ONVL, "0x1")
  field(TWVL, "0x2")
  field(THSV, "INVALID")
  field(FRSV, "INVALID")
  field(FVSV, "INVALID")
  field(SXSV, "INVALID")
  field(SVSV, "INVALID")
  field(EISV, "INVALID")
  field(NISV, "INVALID")
  field(TESV, "INVALID")
  field(ELSV, "INVALID")
  field(TVSV, "INVALID")
  field(TTSV, "INVALID")
  field(FTSV, "INVALID")
  field(FFSV, "INVALID")
  field(UNSV, "INVALID")
  field(IVOA, "Don't drive outputs")
  field(FLNK, "$(P)TSGen-RB")
  info(autosaveFields_pass0, "VAL")
}

record(mbbi, "$(P)TSGen-RB") {
  field(DESC, "EVG TS Generator")
  field(DTYP, "Obj Prop uint16")
  field(INP,  "@OBJ=$(OBJ), PROP=TS Generator")
  field(ZRST, "Software")
  field(ONST, "Internal")
  field(TWST, "External")
  field(ZRVL, "0x0")
  field(ONVL, "0x1")
  field(TWVL, "0x2")
}
